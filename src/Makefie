# Compiler and flags
CXX = nvcc
CXXFLAGS = -Xcompiler -Wall,-Wno-sign-compare,-Wno-endif-labels,-Wno-unused-variable -O3 -std=c++14

# Include directories for CUDA libraries
INCLUDES = -I/usr/include -I../lib -I/usr/local/cuda/include

# Libraries to link against, including cuBLAS
LIBS = -L../lib -lcpu2des -lcublas

# Source files (changed .cpp to .cu)
SRCS = GPU_2DES.cu GPU_dynamics.cu

# Object files
OBJS = $(SRCS:.cu=.o)

# Executable names
EXEC_2DES = GPU_2DES
EXEC_DYNAMICS = GPU_dynamics

# Default target (build both executables)
all: $(EXEC_2DES) $(EXEC_DYNAMICS)

# Link the GPU_2DES executable
$(EXEC_2DES): GPU_2DES.o
	$(CXX) $(CXXFLAGS) -o $(EXEC_2DES) GPU_2DES.o $(LIBS)

# Link the GPU_dynamics executable
$(EXEC_DYNAMICS): GPU_dynamics.o
	$(CXX) $(CXXFLAGS) -o $(EXEC_DYNAMICS) GPU_dynamics.o $(LIBS)

# Compile source files into object files
%.o: %.cu
	$(CXX) $(CXXFLAGS) $(INCLUDES) -dc $< -o $@

# Clean up the build directory
clean:
	rm -f $(OBJS) $(EXEC_2DES) $(EXEC_DYNAMICS)

# Phony targets
.PHONY: all clean
